# Система управления библиотекой
### 1. Введение ID для сущностей
- Добавлены атрибуты `_id` в классы `Book`, `Author`, `Loan`
- ID загружаются из БД в методах `_load_*`
- Все операции используют ID вместо названий (надежнее при дубликатах)
- Добавлены getter-методы `get_id()` для всех сущностей

### 2. Улучшение идентификации авторов
- Добавлен `UNIQUE` constraint на `authors.name` в БД
- Добавлено поле для ввода биографии (`bio`) при добавлении книги в GUI
- Метод `add_book()` проверяет существование автора перед добавлением

### 3. Аутентификация и роли
- Реализован экран логина с вводом ID библиотекаря
- Проверка `access_level` при входе
- Разные права доступа для библиотекарей и пользователей
- Видимость функций зависит от роли (только библиотекари могут добавлять/удалять)
- Функция выхода для переключения пользователей

### 4. Обработка дубликатов и AUTOINCREMENT
- Таблица `users` теперь использует `id INTEGER PRIMARY KEY AUTOINCREMENT`
- Устранена уязвимость с ручным вычислением max ID
- Добавлены CHECK constraints:
  - `year > 0` для таблицы `books`
  - `access_level > 0` для таблицы `librarians`

### 5. Расширение функциональности
- Методы редактирования:
  - `edit_book()` - редактирование названия, года, биографии автора
  - `edit_user()` - редактирование имени пользователя
- Методы удаления с подтверждением в GUI
- Функции поиска:
  - `find_book_by_title()` - поиск книг по подстроке названия
  - `find_user_by_name()` - поиск пользователей по имени
  - `find_author_by_name()` - поиск авторов
- Показ биографии автора в списке книг

### 6. Улучшения в коде и стиле
- **Docstrings**: Все методы имеют подробные docstring'и с описанием параметров и возвращаемых значений
- **Комментарии**: Добавлены пояснительные комментарии к сложным операциям
- **Обработка ошибок**: 
  - Расширенные `try-except` для `sqlite3.Error`
  - Проверка лимитов на книги (до 3 для пользователей, до 5 для библиотекарей)
  - Проверка на просрочку книг
- **Логирование**: Интегрирован модуль `logging`:
  - Все значимые операции логируются в файл `library.log`
  - Ошибки записываются с контекстом

### 7. Полиморфизм и абстракция
- `Person` - абстрактный класс с методом `borrow_book()`
- Разные реализации `borrow_book()` для `User` (максимум 3 книги) и `Librarian` (максимум 5)
- Константы `MAX_BOOKS` и `MAX_BOOKS_LIBRARIAN` в классах
- Метод `borrow_book()` теперь проверяет и возвращает осмысленные результаты

### 8. Инкапсуляция
- Добавлены setter-методы для всех приватных атрибутов:
  - `set_name()` - устанавливает имя
  - `set_title()` - устанавливает название книги
  - `set_year()` - устанавливает год с проверкой
  - `set_status()` - устанавливает статус книги
  - `set_bio()` - устанавливает биографию автора
  - `set_access_level()` - устанавливает уровень доступа
- Consistentный доступ через getters/setters вместо прямого обращения

### 9. Datetime и просрочки
- В GUI добавлена колонка "Статус" в списке выдач
- Метод `is_overdue()` проверяет просрочку
- Визуальная индикация просрочки:
  - Красная подсветка для просроченных
  - Значок (ПРОСРОЧЕНО) рядом со статусом

### 10. Улучшения в GUI (Tkinter)

#### Выбор из списков:
- `Combobox` вместо ручного ввода текста для:
  - Выбора пользователя при выдаче книги
  - Выбора книги при выдаче
  - Выбора выдачи при возврате
  - Выбора книги/пользователя при редактировании

#### Поиск и фильтры:
- Поисковая строка в списках книг и пользователей
- Поиск по подстроке в режиме реального времени
- Методы фильтрации в `LibrarySystem`

#### Автообновление:
- После выдачи/возврата книги список автоматически обновляется
- Кнопки "Обновить" для ручного обновления

#### Валидация ввода:
- Проверка пустых полей
- Валидация года (только цифры, 1-2100)
- Проверка существования объектов перед операциями

#### Дизайн и UX:
- Скроллбары для Treeview в больших списках
- Окно resizable с минимальным размером (800x600)
- Улучшенная цветовая схема:
  - Зеленый текст для доступных книг
  - Красный текст для выданных/просроченных
- Отступы и выравнивание для лучшей читаемости

### 11. Улучшения в БД (SQLite)

#### Индексы и constraints:
- `INDEX` на `authors.name` - для быстрого поиска авторов
- `INDEX` на `books.title` - для быстрого поиска книг
- `INDEX` на `loans.user_id` и `loans.book_id` - для быстрого поиска выдач
- `CHECK` constraints для целостности данных

#### Транзакции:
- Все модифицирующие операции используют `self._conn.commit()` для атомарности
- `rollback()` при ошибках в критических операциях

#### Закрытие ресурсов:
- Методы БД должным образом работают с курсорами
- Подключение закрывается в методе `close()`
- `row_factory = sqlite3.Row` для удобной работы с данными

## Аутентификация

**Вход в систему:**
1. При запуске показывается экран логина
2. Введите ID библиотекаря (для демо: **1**)
3. При успешном входе открывается основное меню

**Уровни доступа:**
- `access_level = 1`: Полный доступ (добавление, удаление, редактирование)
- `access_level = 0`: Ограниченный доступ (только просмотр)

## Структура БД

```
authors
  ├─ id (PRIMARY KEY, AUTOINCREMENT)
  ├─ name (TEXT, UNIQUE)
  └─ bio (TEXT)

books
  ├─ id (PRIMARY KEY, AUTOINCREMENT)
  ├─ title (TEXT)
  ├─ author_id (FOREIGN KEY → authors.id)
  ├─ year (INTEGER, CHECK > 0)
  └─ status (TEXT)

users
  ├─ id (PRIMARY KEY, AUTOINCREMENT) <- УЛУЧШЕНО
  └─ name (TEXT)

librarians
  ├─ id (PRIMARY KEY)
  ├─ name (TEXT)
  └─ access_level (INTEGER, CHECK > 0)

loans
  ├─ id (PRIMARY KEY, AUTOINCREMENT)
  ├─ book_id (FOREIGN KEY → books.id)
  ├─ user_id (FOREIGN KEY → users.id)
  ├─ issue_date (TEXT)
  └─ return_date (TEXT)
```

## Запуск

```bash
python 1.py
```

## Логирование

Все операции логируются в файл `library.log`:
- Вход/выход пользователей
- Добавление/удаление/редактирование сущностей
- Ошибки и исключения

## Улучшенные ООП концепции

1. **Наследование**: `User` и `Librarian` наследуют от `Person`
2. **Полиморфизм**: Разные реализации `borrow_book()` в разных классах
3. **Инкапсуляция**: Все атрибуты приватные (`_`), доступ через методы
4. **Композиция**: `Book` содержит `Author`, `Loan` содержит `Book` и `User`
5. **Абстракция**: `Person` - абстрактный класс с методами, которые должны быть переопределены

## Особенности

- Безопасность: Использование ID вместо имен для операций
- Надежность: Проверка на дубликаты и целостность данных
- Удобство: Интуитивный GUI с поиском и фильтрацией
- Масштабируемость: Правильная структура кода, легко расширяется
- Поддерживаемость: Docstrings, логирование, обработка ошибок


